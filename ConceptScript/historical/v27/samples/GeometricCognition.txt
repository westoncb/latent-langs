CONCEPT GeometricCognition {
  NOTATION {
    M âŠ• N = directSum(M, N)
    M âŠ— N = tensorProduct(M, N)
    T(M) = tangentBundle(M)
    exp_p = exponential(p)
    par_X = parallel(X)
    âˆ‡_X = covariantDerivative(X)
    G(p, q) = geodesic(p, q)
    // Notation for mental states, mental actions, and their transformations  
    Ï†|ÏˆâŸ© = mentalTransition(Ï†, Ïˆ)
    âŸ¨Ï†| = dualState(Ï†)
    |Ï†âŸ©âŠ—|ÏˆâŸ© = mentalComposition(Ï†, Ïˆ)
    U(t)|Ï†âŸ© = mentalEvolution(U, t, Ï†)
  }

  LANGUAGE {
    TYPE MentalState = VectorSpace
    TYPE MentalTransformation = VectorSpace -> VectorSpace
    TYPE CognitiveManifold = Manifold
    TYPE ConceptualSpace = VectorBundle
    TYPE MentalDynamics = (MentalState, Time) -> MentalState

    FUNC directSum(M: VectorSpace, N: VectorSpace) : VectorSpace = 
      (M.basis() Ã— N.basis()) -> (m, n) => M.element(m) + N.element(n)
    FUNC tensorProduct(M: VectorSpace, N: VectorSpace) : VectorSpace =
      (M.basis() Ã— N.basis()) -> (m, n) => M.element(m) * N.element(n)

    FUNC tangentBundle(M: Manifold) : VectorBundle =
      M -> p => VectorSpace{e_i(p) for e_i âˆˆ M.frame(p)}

    FUNC exponential(p: Manifold.Point) : Manifold.Point -> Manifold.Point = 
      X => LET Î³ = geodesic(0, X) IN Î³(1)

    PRED parallel(X: VectorField) : Bool = âˆ‡_X(X) = 0
  }

  STRUCTURES {
    STRUCTURE Mind {
      FIELD state : MentalState
      FIELD dynamics : MentalDynamics
      FIELD transformations : List<MentalTransformation>

      COMPUTE apply(U: MentalTransformation) : MentalState = U(state)
      COMPUTE evolve(t: Time) : MentalState = dynamics(state, t)
    }

    STRUCTURE Concept {
      FIELD meaning : ConceptualSpace.Section
      FIELD associations : List<Concept>
      
      COMPUTE similarityTo(that: Concept) : Real = 
        LET d = dist(meaning, that.meaning) IN exp(-d^2)

      COMPUTE combine(that: Concept) : Concept = 
        Concept{
          (meaning âŠ• that.meaning) / 2,
          append(associations, that) + that.associations  
        }
    }
  }

  TRANSFORMERS {
    REWRITE DirectSumAssociativity : (M âŠ• N) âŠ• P -> M âŠ• (N âŠ• P) 
    REWRITE TensorProductAssociativity : (M âŠ— N) âŠ— P -> M âŠ— (N âŠ— P)
    REWRITE MentalTransformationComposition : U(V|Ï†âŸ©) -> (U âˆ˜ V)|Ï†âŸ©

    TACTIC CommuteMentalTransformations : 
      REWRITE U(V|Ï†âŸ©) -> V(U|Ï†âŸ©) WHEN U âˆ˜ V = V âˆ˜ U

    SIMPLIFY NormalizeState : |Ï†âŸ© / âŸ¨Ï†|Ï†âŸ© -> |Ï†âŸ©
    SIMPLIFY InfinitesimalGenerator : (U(dt) - ğŸ™) / dt |Ï†âŸ© -> H|Ï†âŸ© WHEN dU/dt = -i H
  } 

  PROOFS {
    PROOF StateEvolutionUnitarity : âˆ€ |Ï†âŸ©, U, t . âŸ¨Ï†|Uâ€ (t) U(t)|Ï†âŸ© = 1 {
      GIVEN |Ï†âŸ© : MentalState, U : MentalTransformation, t : Time
      ASSUME U is unitary

      âŸ¨Ï†|Uâ€ (t) U(t)|Ï†âŸ©
        == âŸ¨Ï†| Uâ€ (t) (U(t) |Ï†âŸ©)     BY DEF of notation
        == âŸ¨Ï†| (Uâ€ (t) âˆ˜ U(t)) |Ï†âŸ©   BY MentalTransformationComposition
        == âŸ¨Ï†| ğŸ™ |Ï†âŸ©                BY DEF of unitary transformation  
        == âŸ¨Ï†|Ï†âŸ©                    BY identity transformation
        == 1                       BY normalization of |Ï†âŸ©

      QED  
    }

    PROOF ContinuityOfMentalEvolution : âˆ€ |Ï†âŸ©, U, t, Îµ . || |Ï†(t+Îµ)âŸ© - |Ï†(t)âŸ© || < Î´(Îµ) âˆ§ lim[Îµ->0] Î´(Îµ) = 0 {
      GIVEN |Ï†âŸ© : MentalState, U : MentalTransformation, t : Time, Îµ : Real
      ASSUME U is continuous, |Ï†âŸ© = U(t)|Ï†âŸ©
      
      |Ï†(t+Îµ)âŸ© - |Ï†(t)âŸ©  
        == U(t+Îµ)|Ï†âŸ© - U(t)|Ï†âŸ©                        EXPAND |Ï†(t)âŸ©
        == (U(t+Îµ) - U(t))|Ï†âŸ©                         DISTRIBUTIVITY of MentalTransformation over +
        == ((U(t+Îµ) - U(t)) / Îµ) Îµ |Ï†âŸ©                MULTIPLY by Îµ/Îµ
        == ((U(t+Îµ) - U(t)) / Îµ) Îµ |Ï†âŸ©                SIMPLIFY
        == (dU/dt) Îµ |Ï†âŸ© + ğ’ª(Îµ^2)                     BY DEF of derivative, Taylor expansion
        == -i H Îµ |Ï†âŸ© + ğ’ª(Îµ^2)                        BY InfinitesimalGenerator  
      
      TAKE NORM OF BOTH SIDES:
        || |Ï†(t+Îµ)âŸ© - |Ï†(t)âŸ© || = || -i H Îµ |Ï†âŸ© + ğ’ª(Îµ^2) ||
                              <= || -i H Îµ |Ï†âŸ© || + || ğ’ª(Îµ^2) ||   BY triangle inequality
                              <= || H || Îµ + || ğ’ª(Îµ^2) ||          BY norm property, i has norm 1
      
      LET Î´(Îµ) = || H || Îµ + || ğ’ª(Îµ^2) ||
      
      lim[Îµ->0] Î´(Îµ)  
        == lim[Îµ->0] (|| H || Îµ + || ğ’ª(Îµ^2) ||)
        == || H || * 0 + lim[Îµ->0] || ğ’ª(Îµ^2) ||        BY linearity of limits
        == 0 + 0                                       Îµ^2 vanishes faster than Îµ as Îµ->0
        == 0

      QED
    }
  }

  EXAMPLES {
    EXAMPLE QuantumMentalState : MentalState = HILBERT_SPACE
    EXAMPLE QuantumMentalTransformation : MentalTransformation = |Ï†âŸ© => U|Ï†âŸ©
    EXAMPLE ConceptualBlend : Concept = 
      LET physicist = Concept{SUBSPACE(HILBERT_SPACE), []}
      LET dancer = Concept{SUBSPACE(HILBERT_SPACE), []} IN
      physicist.combine(dancer)
  }
}