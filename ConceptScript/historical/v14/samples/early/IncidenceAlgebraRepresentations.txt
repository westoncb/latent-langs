CONCEPT IncidenceAlgebraRepresentations {
  LANGUAGE {
    NOTATION {
      "â‰¤" := "partial order relation"
      "ğŸ™" := "indicator function"
      "ğ‘˜" := "base field"
      "ğ¼" := "incidence algebra"
      "ğ‘…" := "representation"
    }

    type POSet
    type Element : POSet -> Type
    type ğ‘˜ : Field
    type I(P: POSet) : Algebra(ğ‘˜)
    type R(A: Algebra(ğ‘˜)) : Module(ğ‘˜)

    pred (â‰¤) : âˆ€ (P: POSet). Element(P) * Element(P) -> Prop  
    func ğŸ™ : âˆ€ (P: POSet). âˆ€ (x y : Element(P)). (x â‰¤ y) -> ğ‘˜
    func Â· : âˆ€ (P: POSet). I(P) * I(P) -> I(P)
    func eval : âˆ€ (P: POSet). âˆ€ (f : I(P)). âˆ€ (x y : Element(P)). (x â‰¤ y) -> ğ‘˜

    axiom PartialOrder : âˆ€ (P: POSet). 
      (âˆ€ x : Element(P). x â‰¤ x) âˆ§
      (âˆ€ x y : Element(P). (x â‰¤ y âˆ§ y â‰¤ x) â‡’ x = y) âˆ§ 
      (âˆ€ x y z : Element(P). (x â‰¤ y âˆ§ y â‰¤ z) â‡’ x â‰¤ z)

    axiom IncidenceAlgebraAxioms : âˆ€ (P: POSet). âˆ€ (f g : I(P)). âˆ€ (x y z : Element(P)).
      eval(f Â· g)(x, z) = âˆ‘ (y : Element(P)) (x â‰¤ y âˆ§ y â‰¤ z), eval(f)(x, y) * eval(g)(y, z)
      ğŸ™(x, y) = if (x = y) then 1 else 0
  }

  STRUCTURE {
    [âˆ€ (P: POSet). I(P) is an associative ğ‘˜-algebra with unit ğŸ™]
    [âˆ€ (P: POSet). âˆ€ (x y : Element(P)). ğŸ™(x, y) is the identity of I(P)]
    [âˆ€ (P: POSet). âˆ€ (x y z : Element(P)). (x â‰¤ y âˆ§ y â‰¤ z) â‡’ ğŸ™(x, y) Â· ğŸ™(y, z) = ğŸ™(x, z)]
  }

  PROOFS {
    tactic IncidenceAlgebraTactic: {
      (P: POSet); (f g h : I(P)); (x y z w : Element(P)); 
      (x â‰¤ y âˆ§ y â‰¤ z âˆ§ z â‰¤ w) â‡’ (f Â· (g Â· h))(x, w) = ((f Â· g) Â· h)(x, w)
    }
    
    proof AssociativityOfComposition: âˆ€ (P: POSet). âˆ€ (f g h : I(P)). f Â· (g Â· h) = (f Â· g) Â· h {
      let P: POSet, f g h : I(P), x w : Element(P)
      assume x â‰¤ w
      
      eval(f Â· (g Â· h))(x, w)
        = âˆ‘ (z : Element(P)) (x â‰¤ z âˆ§ z â‰¤ w), eval(f)(x, z) * eval(g Â· h)(z, w)  ; by IncidenceAlgebraAxioms
        = âˆ‘ (z : Element(P)) (x â‰¤ z âˆ§ z â‰¤ w), eval(f)(x, z) * 
            (âˆ‘ (y : Element(P)) (z â‰¤ y âˆ§ y â‰¤ w), eval(g)(z, y) * eval(h)(y, w))  ; by IncidenceAlgebraAxioms
        = âˆ‘ (y z : Element(P)) (x â‰¤ z âˆ§ z â‰¤ y âˆ§ y â‰¤ w), 
            eval(f)(x, z) * eval(g)(z, y) * eval(h)(y, w)  ; by rearranging sums
        = âˆ‘ (y : Element(P)) (x â‰¤ y âˆ§ y â‰¤ w), 
            (âˆ‘ (z : Element(P)) (x â‰¤ z âˆ§ z â‰¤ y), eval(f)(x, z) * eval(g)(z, y)) * eval(h)(y, w)  ; by rearranging sums
        = âˆ‘ (y : Element(P)) (x â‰¤ y âˆ§ y â‰¤ w), eval(f Â· g)(x, y) * eval(h)(y, w)  ; by IncidenceAlgebraAxioms
        = eval((f Â· g) Â· h)(x, w)  ; by IncidenceAlgebraAxioms
          
      therefore, âˆ€ x w : Element(P). (x â‰¤ w) â‡’ eval(f Â· (g Â· h))(x, w) = eval((f Â· g) Â· h)(x, w)
      thus, f Â· (g Â· h) = (f Â· g) Â· h  ; by extensionality
    }
      
    proof IdentityOfComposition: âˆ€ (P: POSet). âˆ€ (f : I(P)). ğŸ™ Â· f = f Â· ğŸ™ = f {
      let P : POSet, f : I(P), x y : Element(P)
      assume x â‰¤ y
      
      eval(ğŸ™ Â· f)(x, y) 
        = âˆ‘ (z : Element(P)) (x â‰¤ z âˆ§ z â‰¤ y), ğŸ™(x, z) * eval(f)(z, y)  ; by IncidenceAlgebraAxioms
        = 1 * eval(f)(x, y) + âˆ‘ (z : Element(P)) (x < z âˆ§ z â‰¤ y), 0 * eval(f)(z, y)  ; by definition of ğŸ™
        = eval(f)(x, y)
        
      similarly, eval(f Â· ğŸ™)(x, y) = eval(f)(x, y)
      
      therefore, âˆ€ x y : Element(P). (x â‰¤ y) â‡’ eval(ğŸ™ Â· f)(x, y) = eval(f)(x, y) = eval(f Â· ğŸ™)(x, y)
      thus, ğŸ™ Â· f = f Â· ğŸ™ = f  ; by extensionality
    }
      
    proof RepresentationsAreModules: âˆ€ (P: POSet). âˆ€ (Ï : R(I(P))). Ï is a ğ‘˜-module {
      let P : POSet, Ï : R(I(P)), v w : Ï, c : ğ‘˜, f g : I(P)
      
      Ï(c Â· v) 
        = Ï(c Â· Ï(ğŸ™) Â· v)  ; since Ï(ğŸ™) = id
        = Ï(Ï(c Â· ğŸ™) Â· v)  ; since Ï is a representation
        = Ï(c Â· ğŸ™) Â· Ï(v)  ; by definition of representation
        = c Â· Ï(v)  ; since Ï(c Â· ğŸ™) = c Â· id
        
      Ï(v + w) 
        = Ï(Ï(ğŸ™) Â· (v + w))  ; since Ï(ğŸ™) = id  
        = Ï(ğŸ™) Â· Ï(v + w)  ; by definition of representation
        = Ï(v + w)
        = Ï(v) + Ï(w)  ; by linearity of Ï
        
      Ï(f Â· g) 
        = Ï(f) Â· Ï(g)  ; by definition of representation
        
      therefore, Ï satisfies the axioms of a ğ‘˜-module.
    }
  }
}