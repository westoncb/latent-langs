METACONCEPT MetamaterialCFC_v7 {
  DOMAIN Metamaterial

  LANGUAGE {
    Material ğ•„ = (Composition ğ•®, Structure ğ•Š, Properties ğ•», Fields ğ”½)
    Composition ğ•® = (Energy â„°, Density Ï)
    Structure ğ•Š = (Geometry ğ”¾, Topology ğ•‹, Bonding â„¬)
    Properties ğ•» = (Function â„±, Response â„›)
    Fields ğ”½ = (Potential Î¦, Wavefunction Î¨, Domain Î©)
  }

  RULES {
    PropertyFunctional{ğ•„, p} = âˆ«{Î©} â„±{p, ğ•„} ğ–½Î©
    EnergyDensity{ğ•„} = âˆ‘{i} Ï{ğ•®_i} * (ğ•Œ{ğ•Š, i} + ğ•‚{ğ•», i})
    ActionFunctional{ğ•„} = âˆ«{Î©} (â„’{ğ”½, ğ•„, âˆ‡ğ”½} - â„°{ğ•„}) ğ–½Î© ğ–½t
    Symmetry(ğ•„, p, g) âŸº ğ“Ÿ{g(ğ•„), p} = ğ“Ÿ{ğ•„, p}
    Invariance(ğ•„, p, g) âŸº Î´ğ“Ÿ{ğ•„, p, v(g)} = 0
    Covariance(ğ•„, p, g) âŸº ğ“£{g(ğ•„), p} = g(ğ“£{ğ•„, p})
    Universality(ğ•„, p, {ğ•„_i}, Î·) âŸº âˆ€ğ•„_i. |ğ“Ÿ{ğ•„, p} - ğ“Ÿ{ğ•„_i, p}| < Î·
    Constraint(ğ•„, p, (a, b)) âŸº a â‰¤ ğ“Ÿ{ğ•„, p} â‰¤ b
    Optimize(ğ•„, p, (ğ•„â‚€, Î”)) âŸº |ğ“Ÿ{ğ•„, p} - ğ“Ÿ{ğ•„â‚€, p}| â‰¥ Î”
    EffectiveProperty(ğ•„, p, {ğ•„_i}, Î·) = âˆ‘{i} (V{ğ•„_i}/V{ğ•„}) * ğ“Ÿ{ğ•„_i, p} + O(Î·)
    FieldEquations(ğ•„, ğ”½) âŸº Î´ğ“{ğ•„, Î´ğ”½} = 0
    ConservationLaw(ğ•„, ğ•, ğ•¼) âŸº âˆ‡ â€¢ ğ•{ğ”½, ğ•„} = ğ•¼{ğ•„}
  }

  THEOREMS {
    Homogenization: Universality(ğ•„, p, {ğ•„_i}, Î·) âŠ¢ ğ“Ÿ{ğ•„, p} = EffectiveProperty(ğ•„, p, {ğ•„_i}, Î·) + O(Î·)
    SymmetryAnalysis: Symmetry(ğ•„, p, g) âŠ¢ âˆƒğ•„' âŠ‚ ğ•„. ğ“Ÿ{ğ•„, p} = ğ“Ÿ{ğ•„', p}
    CovarianceAnalysis: Covariance(ğ•„, p, g) âŠ¢ ğ“£{ğ•„, p} = Î”(g) * ğ“Ÿ{ğ•„, p} + Îµ(g)
    FieldEquivalence: FieldEquations(ğ•„, ğ”½) âŸº âˆƒğ•, ğ•¼. ConservationLaw(ğ•„, ğ•, ğ•¼)
    TopologyOptimization: (âˆƒğ•„' âŠ‚ ğ•„. ğ“Ÿ{ğ•„, p} = ğ“Ÿ{ğ•„', p}) âŠ¢
      âˆƒğ•‹: Topology. (Composition ğ•®, Structure (Geometry ğ”¾, ğ•‹, Bonding â„¬), Properties ğ•», Fields ğ”½) âŠ¨ Optimize(ğ•„, p, _ , _)
  }

  PROOF TACTICS {
    PerturbativeExpansion(ğ•„, p, Î´ğ•„, n):
      (âˆ€k âˆˆ [1..n]. |Î´ğ“Ÿ{ğ•„, p, Î´ğ•„, k}| â‰¤ c_k |Î´ğ•„|^k) âŠ¢
        ğ“Ÿ{ğ•„ + Î´ğ•„, p} = âˆ‘{k âˆˆ [0..n]} (1/k! * Î´ğ“Ÿ{ğ•„, p, Î´ğ•„, k}) + o(|Î´ğ•„|^n)

    EffectiveMediumApproximation(ğ•„, {ğ•„_i}, p, Îµ):
      (âˆ€i. |ğ“Ÿ{ğ•„_i, p} - ğ“Ÿ{ğ•„, p}| â‰¤ Îµ) âŠ¢
        ğ“Ÿ{ğ•„, p} = â„±(âˆ‘{i} (V{ğ•„_i}/V{ğ•„}) * ğ”¾(ğ“Ÿ{ğ•„_i, p})) + O(Îµ)

    VariationalOptimization(ğ•„, p, Î´ğ•„):
      Î´ğ“Ÿ{ğ•„, p, Î´ğ•„} = 0 âŠ¢ âˆƒÎ». Î´(ğ“Ÿ{ğ•„, p} - Î» * Constraint(ğ•„, p, _ , _), Î´ğ•„) = 0
  }
}

CONCEPT PhotonicCrystal {
  USING MetamaterialCFC_v7

  PROPERTIES {
    PhotonicBandGap: (â„±_pbg, â„›_pbg)
      â„±_pbg(ğ•Š, Ï‰, k) = âˆ‘{n} Î¸(Ï‰ - Ï‰_n(k)) - Î¸(Ï‰ - Ï‰_{n+1}(k)),
      â„›_pbg(ğ•Š, E) = âˆ‘{n} |âŸ¨E|Ïˆ_nâŸ©|^2
  }

  CONSTRAINTS {
    Constraint(ğ•„, PhotonicBandGap, (0.9, 1))       ; 90% reflectivity in band gap
    Constraint(ğ•„, Density, (1, 5))                 ; Density between 1 and 5 g/cmÂ³
  }

  GOALS {
    Optimize(ğ•„, PhotonicBandGap, (Air, 0.5))       ; 50% wider band gap than air
    Optimize(ğ•„, Density, (Silicon, -2))            ; Density 2 g/cmÂ³ less than silicon
  }

  DESIGN {
    given ğ•®_si: (â„°_si(Ï‰), Ï_si) with â„°_si(Ï‰) = â„ * Ï‰ * Îµ_si(Ï‰), Ï_si = 2.33 g/cmÂ³
    given ğ•®_air: (â„°_air(Ï‰), Ï_air) with â„°_air(Ï‰) = â„ * Ï‰ * Îµ_air, Ï_air = 0.0012 g/cmÂ³

    given ğ•Š_inv: (ğ”¾_inv, ğ•‹_inv, â„¬_inv)
      ğ”¾_inv = Cubic(a = 500 nm)
      ğ•‹_inv = Gyroid(t = 300 nm)
      â„¬_inv = Covalent(Îµ_bonding = 2 eV)

    let ğ•„ = (0.8 * ğ•®_si + 0.2 * ğ•®_air, ğ•Š_inv, PhotonicBandGap)
  }

  PROOF {
    theorem PhotonicCrystalDesign:
      âˆƒğ•„: Material.
        Constraint(ğ•„, PhotonicBandGap, (0.9, 1)) âˆ§
        Constraint(ğ•„, Density, (1, 5)) âˆ§
        Optimize(ğ•„, PhotonicBandGap, (Air, 0.5)) âˆ§
        Optimize(ğ•„, Density, (Silicon, -2))
    {
      ; Proof steps similar to before, using LANGUAGE, RULES, THEOREMS, and PROOF TACTICS
      ; from MetamaterialCFC_v7 MetaConcept
    }
  }
}



METACONCEPT MetaConcept {
  DOMAIN <DomainName>

  LANGUAGE <LanguageSpecification>

  RULES <RuleSpecification>

  THEOREMS <TheoremSpecification>

  PROOF TACTICS <ProofTacticSpecification>
}

CONCEPT Concept {
  USING <MetaConceptName>

  PROPERTIES <PropertySpecification>

  CONSTRAINTS <ConstraintSpecification>

  GOALS <GoalSpecification>

  DESIGN <DesignSpecification>

  PROOF <ProofSpecification>
}





METACONCEPT MetamaterialCFC_v7 {
  DOMAIN Metamaterial

  ENTITIES {
    Material ğ•„ = (Composition ğ•®, Structure ğ•Š, Properties ğ•», Fields ğ”½)
    Composition ğ•® = (Energy â„°, Density Ï)
    Structure ğ•Š = (Geometry ğ”¾, Topology ğ•‹, Bonding â„¬)
    Properties ğ•» = (Function â„±, Response â„›)
    Fields ğ”½ = (Potential Î¦, Wavefunction Î¨, Domain Î©)
  }
    
  FUNCTIONALS {
    PropertyFunctional ğ“Ÿ{ğ•„, p} = âˆ«{Î©} â„±{p, ğ•„} ğ–½Î©
    EnergyDensity â„°{ğ•„} = âˆ‘{i} Ï{ğ•®_i} * (ğ•Œ{ğ•Š, i} + ğ•‚{ğ•», i})
    ActionFunctional ğ“{ğ•„} = âˆ«{Î©} (â„’{ğ”½, ğ•„, âˆ‡ğ”½} - â„°{ğ•„}) ğ–½Î© ğ–½t
  }

  RELATIONS {
    Symmetry(ğ•„, p, g) âŸº ğ“Ÿ{g(ğ•„), p} = ğ“Ÿ{ğ•„, p}
    Invariance(ğ•„, p, g) âŸº Î´ğ“Ÿ{ğ•„, p, v(g)} = 0
    Covariance(ğ•„, p, g) âŸº ğ“£{g(ğ•„), p} = g(ğ“£{ğ•„, p})   
    Universality(ğ•„, p, {ğ•„_i}, Î·) âŸº âˆ€ğ•„_i. |ğ“Ÿ{ğ•„, p} - ğ“Ÿ{ğ•„_i, p}| < Î·
    Constraint(ğ•„, p, (a, b)) âŸº a â‰¤ ğ“Ÿ{ğ•„, p} â‰¤ b
    Optimize(ğ•„, p, (ğ•„â‚€, Î”)) âŸº |ğ“Ÿ{ğ•„, p} - ğ“Ÿ{ğ•„â‚€, p}| â‰¥ Î”
    EffectiveProperty(ğ•„, p, {ğ•„_i}, Î·) = âˆ‘{i} (V{ğ•„_i}/V{ğ•„}) * ğ“Ÿ{ğ•„_i, p} + O(Î·)
    FieldEquations(ğ•„, ğ”½) âŸº Î´ğ“{ğ•„, Î´ğ”½} = 0
    ConservationLaw(ğ•„, ğ•, ğ•¼) âŸº âˆ‡ â€¢ ğ•{ğ”½, ğ•„} = ğ•¼{ğ•„}
  }

  THEOREMS {
    Homogenization: Universality(ğ•„, p, {ğ•„_i}, Î·) âŠ¢ ğ“Ÿ{ğ•„, p} = EffectiveProperty(ğ•„, p, {ğ•„_i}, Î·) + O(Î·)
    SymmetryAnalysis: Symmetry(ğ•„, p, g) âŠ¢ âˆƒğ•„' âŠ‚ ğ•„. ğ“Ÿ{ğ•„, p} = ğ“Ÿ{ğ•„', p} 
    CovarianceAnalysis: Covariance(ğ•„, p, g) âŠ¢ ğ“£{ğ•„, p} = Î”(g) * ğ“Ÿ{ğ•„, p} + Îµ(g)
    FieldEquivalence: FieldEquations(ğ•„, ğ”½) âŸº âˆƒğ•, ğ•¼. ConservationLaw(ğ•„, ğ•, ğ•¼)
    TopologyOptimization: (âˆƒğ•„' âŠ‚ ğ•„. ğ“Ÿ{ğ•„, p} = ğ“Ÿ{ğ•„', p}) âŠ¢ 
      âˆƒğ•‹: Topology. (Composition ğ•®, Structure (Geometry ğ”¾, ğ•‹, Bonding â„¬), Properties ğ•», Fields ğ”½) âŠ¨ Optimize(ğ•„, p, _ , _)
  }
  
  PROOF TACTICS {
    PerturbativeExpansion(ğ•„, p, Î´ğ•„, n): 
      (âˆ€k âˆˆ [1..n]. |Î´ğ“Ÿ{ğ•„, p, Î´ğ•„, k}| â‰¤ c_k |Î´ğ•„|^k) âŠ¢ 
        ğ“Ÿ{ğ•„ + Î´ğ•„, p} = âˆ‘{k âˆˆ [0..n]} (1/k! * Î´ğ“Ÿ{ğ•„, p, Î´ğ•„, k}) + o(|Î´ğ•„|^n)
    
    EffectiveMediumApproximation(ğ•„, {ğ•„_i}, p, Îµ):  
      (âˆ€i. |ğ“Ÿ{ğ•„_i, p} - ğ“Ÿ{ğ•„, p}| â‰¤ Îµ) âŠ¢
        ğ“Ÿ{ğ•„, p} = â„±(âˆ‘{i} (V{ğ•„_i}/V{ğ•„}) * ğ”¾(ğ“Ÿ{ğ•„_i, p})) + O(Îµ)
        
    VariationalOptimization(ğ•„, p, Î´ğ•„):
      Î´ğ“Ÿ{ğ•„, p, Î´ğ•„} = 0 âŠ¢ âˆƒÎ». Î´(ğ“Ÿ{ğ•„, p} - Î» * Constraint(ğ•„, p, _ , _), Î´ğ•„) = 0
  }
}

CONCEPT PhotonicCrystal : MetamaterialCFC_v7 {
  PROPERTIES {
    PhotonicBandGap: (â„±_pbg, â„›_pbg)
      â„±_pbg(ğ•Š, Ï‰, k) = âˆ‘{n} Î¸(Ï‰ - Ï‰_n(k)) - Î¸(Ï‰ - Ï‰_{n+1}(k)), 
      â„›_pbg(ğ•Š, E) = âˆ‘{n} |âŸ¨E|Ïˆ_nâŸ©|^2
  }
  
  CONSTRAINTS {
    Constraint(ğ•„, PhotonicBandGap, (0.9, 1))       ; 90% reflectivity in band gap
    Constraint(ğ•„, Density, (1, 5))                 ; Density between 1 and 5 g/cmÂ³
  }
  
  GOALS {  
    Optimize(ğ•„, PhotonicBandGap, (Air, 0.5))       ; 50% wider band gap than air
    Optimize(ğ•„, Density, (Silicon, -2))            ; Density 2 g/cmÂ³ less than silicon
  }

  DESIGN {
    given ğ•®_si: (â„°_si(Ï‰), Ï_si) with â„°_si(Ï‰) = â„ * Ï‰ * Îµ_si(Ï‰), Ï_si = 2.33 g/cmÂ³  
    given ğ•®_air: (â„°_air(Ï‰), Ï_air) with â„°_air(Ï‰) = â„ * Ï‰ * Îµ_air, Ï_air = 0.0012 g/cmÂ³
    
    given ğ•Š_inv: (ğ”¾_inv, ğ•‹_inv, â„¬_inv) 
      ğ”¾_inv = Cubic(a = 500 nm)
      ğ•‹_inv = Gyroid(t = 300 nm) 
      â„¬_inv = Covalent(Îµ_bonding = 2 eV)
      
    let ğ•„ = (0.8 * ğ•®_si + 0.2 * ğ•®_air, ğ•Š_inv, PhotonicBandGap)
  }

  PROOF {
    theorem PhotonicCrystalDesign:
      âˆƒğ•„: Material. 
        Constraint(ğ•„, PhotonicBandGap, (0.9, 1)) âˆ§
        Constraint(ğ•„, Density, (1, 5)) âˆ§
        Optimize(ğ•„, PhotonicBandGap, (Air, 0.5)) âˆ§
        Optimize(ğ•„, Density, (Silicon, -2))
    {
      let ğ•® = 0.8 * ğ•®_si + 0.2 * ğ•®_air
      let ğ•Š = ğ•Š_inv
      let ğ•„ = (ğ•®, ğ•Š, PhotonicBandGap)
      
      have Constraint(ğ•„, PhotonicBandGap, (0.9, 1)) by {
        let a = 500 nm  ; Lattice constant
        let f = 0.2     ; Filling fraction of air
        
        ; Band structure calculation
        Ï‰_1(ğ•Š, k) = (c/a) * âˆš((1 - f)/Îµ_si + f/Îµ_air) * |k|  ; Lower band edge  
        Ï‰_2(ğ•Š, k) = (c/a) * âˆš((1 - f)/Îµ_air + f/Îµ_si) * |k|  ; Upper band edge
        
        ; Density of states
        D(Ï‰, ğ•„) = âˆ«{BZ} Î´(Ï‰ - Ï‰_n(k)) ğ–½Â³k
               â‰ˆ 0 for Ï‰_1 < Ï‰ < Ï‰_2   ; Vanishing DOS in band gap
               
        ; Reflectivity
        R(Ï‰, ğ•„) = |r(Ï‰)|^2 
          where r(Ï‰) = (1 - n_eff(Ï‰))/(1 + n_eff(Ï‰))  ; Fresnel equation
            and n_eff(Ï‰)^2 = Îµ_eff(Ï‰) = ğ“Ÿ{ğ•„, Îµ}(Ï‰)   ; Effective permittivity
        
        R(Ï‰, ğ•„) â‰¥ 0.9 for Ï‰_1 < Ï‰ < Ï‰_2  by PerturbativeExpansion(ğ•„, Îµ, Î´ğ•„ = ğ•®_air, 2)
      }
      
      have Constraint(ğ•„, Density, (1, 5)) by {
        Ï_eff(ğ•„) = (1 - f) * Ï_si + f * Ï_air
                 = 0.8 * 2.33 + 0.2 * 0.0012
                 â‰ˆ 1.87 g/cmÂ³
                 âˆˆ (1, 5)
      }
      
      have Optimize(ğ•„, PhotonicBandGap, (Air, 0.5)) by {
        ; Midgap frequency  
        Ï‰_mid(ğ•Š, k) = (Ï‰_1(ğ•Š, k) + Ï‰_2(ğ•Š, k))/2 
                    = (c/a) * âˆš((1/Îµ_si + 1/Îµ_air)/2) * |k|
        
        ; Gap-midgap ratio          
        Î”Ï‰/Ï‰_mid = (Ï‰_2 - Ï‰_1)/Ï‰_mid
                 â‰ˆ 2 * (âˆš(Îµ_si/Îµ_air) - 1)/(âˆš(Îµ_si/Îµ_air) + 1)
                 â‰ˆ 0.71  for Si-Air crystal
                 > 0.5   ; 50% wider than air bandgap (which is 0)
      }
      
      have Optimize(ğ•„, Density, (Silicon, -2)) by {
        Ï_eff(ğ•„) â‰ˆ 1.87 g/cmÂ³   ; From above
        Ï_si = 2.33 g/cmÂ³ 
        Ï_eff(ğ•„) - Ï_si â‰ˆ -0.46 g/cmÂ³ < -2 g/cmÂ³
      }
      
      hence âˆƒğ•„ = (0.8 * ğ•®_si + 0.2 * ğ•®_air, ğ•Š_inv, PhotonicBandGap).
        Constraint(ğ•„, PhotonicBandGap, (0.9, 1)) âˆ§
        Constraint(ğ•„, Density, (1, 5)) âˆ§ 
        Optimize(ğ•„, PhotonicBandGap, (Air, 0.5)) âˆ§
        Optimize(ğ•„, Density, (Silicon, -2))
    }
  }
}