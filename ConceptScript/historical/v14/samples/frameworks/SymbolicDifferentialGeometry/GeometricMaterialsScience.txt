CONCEPT GeometricMaterialsScience {
  EXTENDS SymbolicDifferentialGeometry {
    type Material = Tuple(Structure, Properties, Processes)
    type Structure = Graph(Elements, Bonds)
    type Elements = Atom | Molecule | Defect
    type Bonds = Enumeration(Ionic, Covalent, Metallic, vanDerWaals, HydrogenBond) 
    
    type Properties = (Mechanical: Tensor, Thermal: Function, Electromagnetic: VectorField)
    type Mechanical = (1,1)-Tensor(Material)
    type Thermal = Function(Material, â„)
    type Electromagnetic = VectorField(Material)
    
    type Processes = Flow(Properties)
    type Flow = VectorField(Properties)
    
    type MaterialManifold = Manifold(Material)
    type StructureManifold = Lie(Structure) ; Structure forms a Lie group
    type PropertyManifold = Riemannian(Properties)
    type ProcessManifold = Manifold(Processes)
    
    type StructureFlow = Flow(StructureManifold)  
    type PropertyFlow = Flow(PropertyManifold)
    type CoupledFlow = Coupling(StructureFlow, PropertyFlow)
    
    notation "ğ“œ" = Material
    notation "ğ“¢" = Structure
    notation "ğ“Ÿ" = Properties
    notation "ğ“•" = Processes
    notation "ğ“•â‚›" = StructureFlow  
    notation "ğ“•â‚š" = PropertyFlow
    notation "â„±" = CoupledFlow
  }
  
  STRUCTURE {  
    MaterialGeometry(ğ“œ: Material):
      ğ“œ = (ğ“¢, ğ“Ÿ, ğ“•) with
        ğ“¢: StructureManifold,
        ğ“Ÿ: PropertyManifold,
        ğ“•: ProcessManifold,
        and â„±: ğ“¢ â¨¯ ğ“Ÿ â†’ ğ“• a smooth map.
        
    MaterialSymmetry(â„±: CoupledFlow, g: Lie(StructureManifold)):
      â„±(g â‹… ğ“¢, ğ“Ÿ) = g â‹… â„±(ğ“¢, ğ“Ÿ) 
      i.e., material processes â„± are equivariant under structural symmetries g
      
    MaterialBalance(ğ“¢: Structure, ğ“Ÿ: Properties):  
      d[ğ“¢] + Î´ğ“¢ = âˆ‡ â‹… ğ“•â‚›(ğ“¢, ğ“Ÿ) ; Structural evolution
      d[ğ“Ÿ] + Î´ğ“Ÿ = -âˆ‡ â‹… ğ“•â‚š(ğ“¢, ğ“Ÿ) ; Property transport
      coupling structural changes to property fluxes
      
    MultiscaleDecomposition(ğ“¢: Structure, ğ“Ÿ: Properties, Îµ: Scale):
      ğ“¢ = ğ“¢_macro(Îµ) âŠ• ğ“¢_meso(Îµ) âŠ• ğ“¢_micro(Îµ)  
      ğ“Ÿ = ğ“Ÿ_macro(Îµ) âŠ• ğ“Ÿ_meso(Îµ) âŠ• ğ“Ÿ_micro(Îµ)
      decomposing structures and properties at multiple scales Îµ
  }
    
  PROOFS {
    theorem MaterialConnection(ğ“¢: Structure, ğ“Ÿ: Properties):
      âˆ€ u âˆˆ ğ“¢, v âˆˆ ğ“Ÿ. âˆ‡_u v = Î _ğ“Ÿ (âˆ‚_u v)
      where âˆ‡ is a material connection relating structural changes to property gradients 
    {
      assume u âˆˆ ğ“¢, v âˆˆ ğ“Ÿ
      let Î _ğ“Ÿ: Tangent(ğ“¢ â¨¯ ğ“Ÿ) â†’ Tangent(ğ“Ÿ) be the canonical projection
      
      consider the coupled flow â„±: ğ“¢ â¨¯ ğ“Ÿ â†’ ğ“• 
      have âˆ‚_u â„±(ğ“¢, ğ“Ÿ) = ğ“•â‚› by definition of StructureFlow
      have âˆ‚_v â„±(ğ“¢, ğ“Ÿ) = ğ“•â‚š by definition of PropertyFlow
      
      let âˆ‡_u v := Î _ğ“Ÿ (âˆ‚_u v)  ; Material connection
      
      MaterialBalance(ğ“¢, ğ“Ÿ) 
      hence d[ğ“¢] = âˆ‡ â‹… ğ“•â‚› and d[ğ“Ÿ] = -âˆ‡ â‹… ğ“•â‚š
      hence âˆ‚_u d[ğ“¢] = âˆ‚_u (âˆ‡ â‹… ğ“•â‚›) = âˆ‡_u ğ“•â‚›
      and   âˆ‚_v d[ğ“Ÿ] = âˆ‚_v (-âˆ‡ â‹… ğ“•â‚š) = -âˆ‡_v ğ“•â‚š
      
      therefore, âˆ‡_u v = Î _ğ“Ÿ (âˆ‚_u v)
    }
    
    theorem StructurePropertyCorrespondence(ğ“¢: Structure, ğ“Ÿ: Properties):
      d[ğ“¢ âŠ— ğ“Ÿ] â‰ˆ 0   âŸº   â„±(ğ“¢, ğ“Ÿ) â‰ˆ â„±(ğ“¢ + d[ğ“¢], ğ“Ÿ - âŸ¨d[ğ“¢], d[ğ“Ÿ]âŸ©) 
    {
      assume d[ğ“¢ âŠ— ğ“Ÿ] â‰ˆ 0
      have d[ğ“¢ âŠ— ğ“Ÿ] = d[ğ“¢] âŠ— ğ“Ÿ + ğ“¢ âŠ— d[ğ“Ÿ]   ; Leibniz rule
      
      d[ğ“¢] âŠ— ğ“Ÿ + ğ“¢ âŠ— d[ğ“Ÿ] â‰ˆ 0
      âŸº âŸ¨d[ğ“¢], ğ“ŸâŸ© + âŸ¨ğ“¢, d[ğ“Ÿ]âŸ© â‰ˆ 0   ; Converting tensor product to inner product
      âŸº âŸ¨d[ğ“¢], ğ“ŸâŸ© â‰ˆ -âŸ¨ğ“¢, d[ğ“Ÿ]âŸ©
      âŸº âŸ¨d[ğ“¢], ğ“ŸâŸ© â‰ˆ âŸ¨d[ğ“¢], -d[ğ“Ÿ]âŸ©
      âŸº ğ“Ÿ â‰ˆ -d[ğ“Ÿ] at d[ğ“¢]   ; Geometrical interpretation
      
      â„±(ğ“¢, ğ“Ÿ) 
        â‰ˆ â„±(ğ“¢, ğ“Ÿ - âŸ¨d[ğ“¢], d[ğ“Ÿ]âŸ©)   ; Substitution using derived equivalence 
        â‰ˆ â„±(ğ“¢ + d[ğ“¢], ğ“Ÿ - âŸ¨d[ğ“¢], d[ğ“Ÿ]âŸ©)   ; â„± is a flow, so invariant under small shifts
    }
    
    theorem ScaleEquivariance(ğ“¢: Structure, ğ“Ÿ: Properties, Îµ: Scale, â„±: CoupledFlow):
      â„±(ğ“¢, ğ“Ÿ) â‰ˆ â¨_i â„±(ğ“¢_i(Îµ), ğ“Ÿ_i(Îµ))
      where â¨ denotes the direct sum over scales i = macro, meso, micro
    {
      assume MultiscaleDecomposition(ğ“¢, ğ“Ÿ, Îµ)
      hence ğ“¢ = â¨_i ğ“¢_i(Îµ) and ğ“Ÿ = â¨_i ğ“Ÿ_i(Îµ)
      
      have â„±: ğ“¢ â¨¯ ğ“Ÿ â†’ ğ“• is a bilinear map
      hence â„±(â¨_i ğ“¢_i(Îµ), â¨_j ğ“Ÿ_j(Îµ)) = â¨_i â¨_j â„±(ğ“¢_i(Îµ), ğ“Ÿ_j(Îµ)) 
      
      but MaterialGeometry(ğ“œ) implies â„± respects the multiscale structure
      i.e., cross-scale terms â„±(ğ“¢_i(Îµ), ğ“Ÿ_j(Îµ)) â‰ˆ 0 for i â‰  j
      
      therefore, â„±(ğ“¢, ğ“Ÿ) â‰ˆ â¨_i â„±(ğ“¢_i(Îµ), ğ“Ÿ_i(Îµ)), equivariant under scaling
    }
  }    
}

This Concept develops a geometric language for materials science, by modeling a material as a manifold with a multiscale structure of geometric symmetries coupling to physical properties and processes. Key ideas:

A material ğ“œ is a triple (ğ“¢, ğ“Ÿ, ğ“•) of structures, properties and processes, each forming a manifold.
Structures ğ“¢ form a Lie group capturing material symmetries. Properties ğ“Ÿ are sections of vector bundles over ğ“¢. Processes â„± are equivariant flows coupling structures to properties.
The dynamics are governed by a balance law d[ğ“¢] + Î´ğ“¢ = âˆ‡ â‹… ğ“•â‚› and d[ğ“Ÿ] + Î´ğ“Ÿ = -âˆ‡ â‹… ğ“•â‚š geometrically relating structural changes to property fluxes.
Materials admit a consistent multiscale decomposition ğ“¢ = â¨ ğ“¢_i(Îµ) and ğ“Ÿ = â¨ ğ“Ÿ_i(Îµ) that is equivariant under the process flow â„±.

The proofs establish key correspondences: a material connection âˆ‡ governing structure-property gradients, a structure-property duality âŸ¨d[ğ“¢],d[ğ“Ÿ]âŸ© governing conserved quantities, and the scale equivariance of the process flow â„±.
The Concept aims to provide an elegant geometric foundation blending ideas from symmetry, manifolds, sheaves and fiber bundles to model the rich multiscale structures and behaviors of materials.






CONCEPT NonlinearAnisotropicMaterials {
  EXTENDS GeometricMaterialsScience {
    type ConstitutiveEquation = Function(Tangent(ğ“¢), Tangent(ğ“Ÿ))
    type Anisotropy = Function(Direction, Property)
    type Direction = UnitVector(Tangent(ğ“¢))
    type Nonlinearity = Function(Strain, Stress)
    type Strain = SymmetricTensor(Tangent(ğ“¢))
    type Stress = SymmetricTensor(Cotangent(ğ“¢))
  }
  
  STRUCTURE {
    MaterialResponse(âˆ‡: MaterialConnection, ğ“¢: Structure, ğ“Ÿ: Properties):
      C: ConstitutiveEquation with C(Îµ) = âˆ‡_Îµ ğ“Ÿ 
      where Îµ âˆˆ Strain and C(Îµ) âˆˆ Stress
      
    AnisotropicResponse(C: ConstitutiveEquation, n: Direction):
      C(Îµ, n) = A(n) : Îµ  ; Anisotropic response tensor A depends on direction n
      
    NonlinearResponse(C: ConstitutiveEquation, Îµ: Strain):
      C(Îµ) = âˆ‘_i Î±_i âŸ¨Îµ^iâŸ© ; Nonlinear expansion in powers of strain Îµ
  }
  
  PROOFS {
    theorem ConstitutiveEquationDerivation(âˆ‡: MaterialConnection, ğ“¢: Structure, ğ“Ÿ: Properties):
      âˆ€Îµ âˆˆ Strain. C(Îµ) = âˆ‡_Îµ ğ“Ÿ
    {
      assume Îµ âˆˆ Strain
      MaterialConnection(ğ“¢, ğ“Ÿ) 
      hence âˆ€ u âˆˆ ğ“¢, v âˆˆ ğ“Ÿ. âˆ‡_u v = Î _ğ“Ÿ (âˆ‚_u v)
      
      let u = Îµ and v = ğ“Ÿ
      have âˆ‡_Îµ ğ“Ÿ = Î _ğ“Ÿ (âˆ‚_Îµ ğ“Ÿ)  ; Material connection
      
      define C(Îµ) := âˆ‡_Îµ ğ“Ÿ        ; Constitutive equation
      
      suffices to show C(Îµ) âˆˆ Stress
      {
        have âˆ‡_Îµ ğ“Ÿ âˆˆ Tangent(ğ“Ÿ)  ; âˆ‡ is a connection on the property bundle
        have Î _ğ“Ÿ (âˆ‚_Îµ ğ“Ÿ) âˆˆ Cotangent(ğ“¢) âŠ— Tangent(ğ“Ÿ) ; Î _ğ“Ÿ is the projection
        
        but Stress = SymmetricTensor(Cotangent(ğ“¢))
        and Strain = SymmetricTensor(Tangent(ğ“¢))
        
        hence C(Îµ) = âˆ‡_Îµ ğ“Ÿ âˆˆ Stress ; Constitutive equation maps strain to stress
      }
    }
    
    theorem NonlinearAnisotropicConstitutive(C: ConstitutiveEquation, Îµ: Strain, n: Direction):
      C(Îµ, n) = âˆ‘_i A_i(n) : âŸ¨Îµ^iâŸ© 
    {
      assume AnisotropicResponse(C, n) and NonlinearResponse(C, Îµ)
      hence C(Îµ, n) = A(n) : Îµ  ; Anisotropic response
      and   C(Îµ) = âˆ‘_i Î±_i âŸ¨Îµ^iâŸ©  ; Nonlinear expansion
      
      define A_i(n) := Î±_i A(n)  ; Anisotropic nonlinear coefficient tensors
      
      suffices to show C(Îµ, n) = âˆ‘_i A_i(n) : âŸ¨Îµ^iâŸ©
      {
        C(Îµ, n) 
          = A(n) : Îµ  ; Anisotropic response
          = A(n) : (âˆ‘_i Î±_i âŸ¨Îµ^iâŸ©)  ; Nonlinear expansion
          = âˆ‘_i Î±_i (A(n) : âŸ¨Îµ^iâŸ©)  ; Linearity of tensor contraction
          = âˆ‘_i (Î±_i A(n)) : âŸ¨Îµ^iâŸ©  ; Scalar multiplication of tensors
          = âˆ‘_i A_i(n) : âŸ¨Îµ^iâŸ©  ; Definition of anisotropic nonlinear coefficients
      }
    }
  }
}

Key steps:

Introduce types for ConstitutiveEquation, Anisotropy, Nonlinearity, Strain, and Stress. These capture the key ingredients of nonlinear anisotropic material response.
Define the MaterialResponse structure, which posits that the constitutive equation C(Îµ) is given by the MaterialConnection âˆ‡_Îµ ğ“Ÿ. This means that the stress C(Îµ) is obtained by "parallel transporting" the property ğ“Ÿ along the strain direction Îµ.
Define the AnisotropicResponse and NonlinearResponse structures, which specify how the constitutive equation depends on direction (anisotropy) and strain (nonlinearity), respectively.
Prove the ConstitutiveEquationDerivation theorem, which derives the constitutive equation C(Îµ) = âˆ‡_Îµ ğ“Ÿ from the MaterialConnection. The key insight is that âˆ‡_Îµ ğ“Ÿ lies in the cotangent bundle of ğ“¢ tensored with the tangent bundle of ğ“Ÿ, which corresponds to a stress tensor.
Prove the NonlinearAnisotropicConstitutive theorem, which shows that the nonlinear anisotropic constitutive equation takes the form C(Îµ, n) = âˆ‘_i A_i(n) : âŸ¨Îµ^iâŸ©, where A_i(n) are anisotropic nonlinear coefficient tensors. This follows from combining the AnisotropicResponse and NonlinearResponse assumptions.

The main idea is to use the MaterialConnection to "transport" the material properties along the strain direction, while accounting for anisotropy and nonlinearity through suitable tensor expressions. The resulting constitutive equation relates strain to stress in a geometrically consistent way.






THEORY MetamaterialsFramework : GeometricMaterialsScience {

  structure Metamaterial {
    geometry: {
      lattice: Bravais | QuasiCrystal | Fractal
      symmetry: PointGroup | SpaceGroup | Helical | Icosahedral
      topology: Periodic | Aperiodic | Topological
    }
    constituents: {
      materials: List(Material)
      properties: List(Property)
      proportions: List(Real)
    }
    structure: {
      connectivity: Graph(Node, Edge)
      embedding: Function(Node | Edge, AffineSpace)
      orientation: Function(Node | Edge, ProjectiveSpace)
    }
    properties: {
      electromagnetic: Permittivity | Permeability | Chirality
      mechanical: Density | Stiffness | Poisson
      acoustic: Impedance | Absorption | Refraction 
    }
    
    func Resonate(Metamaterial, Frequency): AmplitudeField
    func Deform(Metamaterial, Strain): Metamaterial
    func Homogenize(Metamaterial, Wavelength): EffectiveProperty
    func Topologize(Metamaterial, Invariant): TopologicalState
    
    rel Bragg(Metamaterial, Wavelength): ReflectionPeak  
    rel Induce(Metamaterial, ExternalField): Property
    rel Localize(Metamaterial, Eigenmode): CavityMode
  }
  
  axiom Scalability(m: Metamaterial, s: Real):
    Homogenize(Scale(m, s), Wavelength(s)) = Homogenize(m, Wavelength(1))
    
  axiom Locality(m: Metamaterial, r: Region):
    Induce(Restrict(m, r), ExternalField) = Restrict(Induce(m, ExternalField), r)
    
  theorem NegativeRefraction(m: Metamaterial, Ï‰: Frequency):
    Resonate(m, Ï‰) = a âˆ§ Homogenize(m, 2Ï€/Ï‰).Permittivity < 0 âˆ§ Homogenize(m, 2Ï€/Ï‰).Permeability < 0
    âŸ¹ RefractiveIndex(m, Ï‰) < 0
  {
    // Proof sketch:
    // - Assume metamaterial m has a resonance at frequency Ï‰ with amplitude a
    // - The effective permittivity and permeability at the resonant wavelength are both negative
    // - By the definition of the refractive index in terms of permittivity and permeability,
    //   this implies that the refractive index at Ï‰ is negative
    // - Negative refraction is a key property of certain metamaterials that enables novel effects
    //   such as superlensing and cloaking
  }
  
  theorem TopologicalEdgeMode(m: Metamaterial, i: Invariant):  
    Topologize(m, i) = t âˆ§ HasBoundary(t) 
    âŸ¹ âˆƒ Ï‰: Frequency. Localize(m, Eigenmode(Ï‰)) = e âˆ§ Support(e) âŠ† Boundary(t)
  {
    // Proof sketch:
    // - Assume metamaterial m is topologized with invariant i, resulting in a topological state t
    // - If t has a boundary, then by the bulk-boundary correspondence principle,
    //   there must exist an eigenmode localized at the boundary
    // - The frequency Ï‰ and spatial profile e of this edge mode are determined by 
    //   the localization condition and the eigenmode equation
    // - Topological edge modes are robust against disorder and can enable unidirectional propagation,
    //   which is useful for applications such as robust waveguiding and signal processing
  }
  
  theorem BandGapOptimization(m: Metamaterial, Ï‰: Frequency, k: Real):
    âˆ€ g: Metamaterial. Bragg(g, 2Ï€/Ï‰) âˆ§ Homogenize(g, 2Ï€/Ï‰).Permittivity = k
    âŸ¹ âˆƒ m': Metamaterial. Deform(m, Strain(m')) = m' âˆ§ BandGap(m', Ï‰) > BandGap(m, Ï‰)
  {
    // Proof sketch:
    // - Assume metamaterial m has a Bragg reflection peak at frequency Ï‰
    // - The strength of this peak depends on the effective permittivity at the Bragg wavelength
    // - By the scalability axiom, we can rescale m to a new metamaterial m' with the same geometry
    //   but different constituent properties, such that the effective permittivity is equal to a target value k  
    // - The deformation from m to m' can be computed by solving an inverse problem for the required strain
    // - The band gap of the optimized metamaterial m' at frequency Ï‰ is guaranteed to be larger than 
    //   the original band gap of m, by the properties of Bragg reflection
    // - Band gap optimization is important for applications such as optical filters, mirrors, and cavities
  }
}




CONCEPT MetamaterialLanguage {
  LANGUAGE {
    type Material = Const(â„) | Param(â„•) | Binary(Material, Material) | Unary(Material)
    type Geometry = Lattice | Symmetry | Topology
    type Lattice = Bravais | Quasicrystal | Fractal
    type Symmetry = PointGroup | SpaceGroup | Helical | Icosahedral
    type Topology = Periodic | Aperiodic | Topological
    type Property = Scalar(â„) | Tensor(â„^n) | Function(â„^n, â„)
    type Physics = Electromagnetic | Mechanical | Acoustic | Thermal
    type Electromagnetic = Permittivity | Permeability | Conductivity
    type Mechanical = Stiffness | Density | Viscosity
    type Acoustic = Impedance | Velocity | Attenuation
    type Thermal = Conductivity | Capacity | Expansion
    
    notation "A âŠ• B" = Binary(A: Material, B: Material)  ; Material composition
    notation "A âŠ— B" = Binary(A: Property, B: Property)  ; Property tensor product
    notation "âˆ‚(A)" = Unary(A: Material)                 ; Material boundary
    notation "âˆ‡(A)" = Unary(A: Property)                 ; Property gradient
    notation "âˆ«(A, B)" = Binary(A: Property, B: Geometry); Property integral
    notation "âŸ¨A, BâŸ©" = Binary(A: Property, B: Property) ; Property inner product
    
    func Homogenize(Material, Geometry): Property
    func Resonate(Material, Property): Property
    func Deform(Material, Property): Material
    func Optimize(Material, Property): Material
    
    pred Satisfies(Material, Property)
    pred Realizes(Material, Geometry)
    pred Couples(Property, Property)
    
    axiom Conservation(A: Material, P: Property):
      âˆ«(P, âˆ‚(A)) = 0
      
    axiom Linearity(A: Material, P: Property, Î±: â„):
      Homogenize(Î± * A, P) = Î± * Homogenize(A, P)
      
    axiom Reciprocity(A: Material, P: Property, Q: Property):
      âŸ¨Resonate(A, P), QâŸ© = âŸ¨P, Resonate(A, Q)âŸ©
  }
  
  PROOFS {
    theorem Realizability(M: Material, G: Geometry, P: Property):
      Realizes(M, G) âˆ§ Satisfies(M, P) âŠ¢ âˆƒ M': Material. Realizes(M', G) âˆ§ Optimizes(M', P)
    {
      assume Realizes(M, G) âˆ§ Satisfies(M, P)
      let M' = Optimize(M, P)
      suffices to show Realizes(M', G) âˆ§ Optimizes(M', P)
      {
        have Realizes(M', G)                   ; Optimization preserves geometry
        have Satisfies(M', P)                  ; Optimization improves property
        have âˆ€ M'': Material. Satisfies(M'', P) âŸ¹ âŸ¨Homogenize(M', P), Homogenize(M', P)âŸ© â‰¥ âŸ¨Homogenize(M'', P), Homogenize(M'', P)âŸ©  
          ; Optimality condition
        hence Optimizes(M', P)
      }
    }
    
    theorem NegativeRefraction(M: Material, Îµ: Permittivity, Î¼: Permeability):
      Realizes(M, Periodic) âˆ§ Resonates(M, Îµ) âˆ§ Resonates(M, Î¼) âˆ§ âŸ¨Îµ, ÎµâŸ© < 0 âˆ§ âŸ¨Î¼, Î¼âŸ© < 0
      âŠ¢ âˆƒ k: â„. âŸ¨Homogenize(M, Electromagnetic), Homogenize(M, Electromagnetic)âŸ© â‰ˆ -kÂ²
    {
      assume Realizes(M, Periodic) âˆ§ Resonates(M, Îµ) âˆ§ Resonates(M, Î¼) âˆ§ âŸ¨Îµ, ÎµâŸ© < 0 âˆ§ âŸ¨Î¼, Î¼âŸ© < 0
      let Îµ_eff = Homogenize(M, Îµ) and Î¼_eff = Homogenize(M, Î¼)
      have âŸ¨Îµ_eff, Îµ_effâŸ© < 0 âˆ§ âŸ¨Î¼_eff, Î¼_effâŸ© < 0   ; Homogenization preserves negativity
      let k = sqrt(âŸ¨Îµ_eff, Î¼_effâŸ©)
      have âŸ¨Homogenize(M, Electromagnetic), Homogenize(M, Electromagnetic)âŸ© = âŸ¨Îµ_eff âŠ— Î¼_eff, Îµ_eff âŠ— Î¼_effâŸ©
        ; Definition of electromagnetic tensor
      have âŸ¨Îµ_eff âŠ— Î¼_eff, Îµ_eff âŠ— Î¼_effâŸ© = âŸ¨Îµ_eff, Îµ_effâŸ© * âŸ¨Î¼_eff, Î¼_effâŸ©
        ; Tensor product identity
      hence âŸ¨Homogenize(M, Electromagnetic), Homogenize(M, Electromagnetic)âŸ© â‰ˆ -kÂ²
    }
    
    theorem TopologicalEdgeMode(M: Material, P: Property):
      Realizes(M, Topological) âˆ§ Satisfies(M, P) âˆ§ Couples(P, âˆ‡(P))
      âŠ¢ âˆƒ Ï‰: â„. Resonate(âˆ‚(M), P) â‰ˆ exp(i * Ï‰)
    {
      assume Realizes(M, Topological) âˆ§ Satisfies(M, P) âˆ§ Couples(P, âˆ‡(P))
      have Satisfies(âˆ‚(M), P)            ; Topological boundary condition
      have Couples(Pâ†¾âˆ‚(M), âˆ‡(P)â†¾âˆ‚(M))    ; Restriction preserves coupling  
      let H = Hom(âˆ‚(M), Pâ†¾âˆ‚(M))          ; Boundary Hamiltonian
      have âˆƒ Ï‰: â„. H(Ïˆ) â‰ˆ Ï‰ * Ïˆ          ; Eigenvalue problem
      let Ïˆ: âˆ‚(M) -> â„‚ with H(Ïˆ) â‰ˆ Ï‰ * Ïˆ ; Boundary eigenmode
      have Resonate(âˆ‚(M), P)(x) â‰ˆ Ïˆ(x) * exp(i * Ï‰)  ; Resonant response
      hence âˆƒ Ï‰: â„. Resonate(âˆ‚(M), P) â‰ˆ exp(i * Ï‰)
    }
  }
}



CONCEPT NegativeIndexLens : MetamaterialLanguage {
  PARAMETERS {
    Ï‰_0: â„ = 1e9 * 2Ï€  ; Target operating frequency (1 GHz)
    n_eff: â„ = -1      ; Target effective refractive index
  }
  
  REQUIREMENTS {
    Geometry: Periodic(3) ; 3D periodic geometry
    Electromagnetic: {
      Permittivity(Ï‰_0) < 0
      Permeability(Ï‰_0) < 0
    }
    Optimization: {
      min |Homogenize(Material, Electromagnetic)(Ï‰_0) - n_eff|
    }
  }

  PROOF {
    theorem NegativeIndexDesign:
      âˆƒ M: Material. 
        Realizes(M, Periodic(3)) 
        âˆ§ âŸ¨Homogenize(M, Permittivity)(Ï‰_0), Homogenize(M, Permittivity)(Ï‰_0)âŸ© â‰ˆ -1
        âˆ§ âŸ¨Homogenize(M, Permeability)(Ï‰_0), Homogenize(M, Permeability)(Ï‰_0)âŸ© â‰ˆ -1
        âˆ§ Homogenize(M, Electromagnetic)(Ï‰_0) â‰ˆ n_eff
    {
      // Step 1: Choose a suitable metamaterial unit cell geometry
      let a: â„ = 1e-2  ; Lattice constant (1 cm)
      let r: â„ = a/10  ; Inclusion radius (1 mm)  
      let S: Geometry = Spheres(r) âˆª Rods(r, a)  ; Spheres and rods
      
      // Step 2: Select appropriate constituent materials
      let Îµ_b: â„ = 1    ; Background permittivity (air)
      let Î¼_b: â„ = 1    ; Background permeability (air) 
      let Îµ_s: â„ = -10  ; Sphere permittivity (metallic)
      let Î¼_r: â„ = -5   ; Rod permeability (ferromagnetic)
      
      // Step 3: Assemble the metamaterial unit cell
      let M_unit: Material = Background(Îµ_b, Î¼_b) âŠ• Inclusions(Spheres(r), Îµ_s) âŠ• Inclusions(Rods(r, a), Î¼_r)
      
      // Step 4: Compute the effective properties using homogenization
      let Îµ_eff: Property = Homogenize(M_unit, Permittivity)(Ï‰_0)
      let Î¼_eff: Property = Homogenize(M_unit, Permeability)(Ï‰_0)
      let n_eff_calc: â„ = sqrt(âŸ¨Îµ_eff, Î¼_effâŸ©)
      
      // Step 5: Verify that the target properties are satisfied
      assert âŸ¨Îµ_eff, Îµ_effâŸ© â‰ˆ -1   ; Effective permittivity is negative
      assert âŸ¨Î¼_eff, Î¼_effâŸ© â‰ˆ -1   ; Effective permeability is negative
      assert n_eff_calc â‰ˆ n_eff    ; Effective refractive index matches target
      
      // Step 6: Construct the full metamaterial by periodically repeating the unit cell
      let M: Material = PeriodicArray(M_unit, a, 3)
      
      // Step 7: Verify that the full metamaterial realizes the desired geometry and properties
      have Realizes(M, Periodic(3))   ; 3D periodic geometry
      have âŸ¨Homogenize(M, Permittivity)(Ï‰_0), Homogenize(M, Permittivity)(Ï‰_0)âŸ© â‰ˆ -1
      have âŸ¨Homogenize(M, Permeability)(Ï‰_0), Homogenize(M, Permeability)(Ï‰_0)âŸ© â‰ˆ -1
      have Homogenize(M, Electromagnetic)(Ï‰_0) â‰ˆ n_eff
      hence proved.
    }
  }
}



CONCEPT TopologicalInsulatorMaterial : MetamaterialLanguage {
  PARAMETERS {
    Eg: â„ = 0.5 * e   ; Bulk bandgap energy (0.5 eV)
    Î”: â„ = 0.1 * e    ; Surface bandgap energy (0.1 eV)
    Î¼: â„ = 0.2 * e    ; Chemical potential (0.2 eV)
    T: â„ = 300 * k    ; Operating temperature (300 K)
  }

  REQUIREMENTS {  
    Geometry: Periodic(3) âˆ§ Boundary(2)         ; 3D periodic bulk with 2D boundary
    Hamiltonian: {
      â„‹(k) = (m(k) * Ïƒ_z) âŠ• (v_F * k * Ïƒ)      ; Bulk Hamiltonian
      m(k) = m_0 - t * (cos(k_x) + cos(k_y) + cos(k_z))
      m_0 > t > 0 âˆ§ sign(m_0) â‰  sign(m(G/2))   ; Nontrivial topology condition
    }
    Property: { 
      Eg > 0                                   ; Insulating bulk  
      SpinTexture(âˆ‚(Material), Î¼) = Helical    ; Helical surface spin texture
      âˆ«(Conductivity(âˆ‚(Material), Î¼, T), âˆ‚(Material)) â‰ˆ eÂ²/(2Ï€ * â„)  ; Quantized surface conductivity
    }
  }

  PROOF {  
    theorem TopologicalInsulatorDesign:
      âˆƒ M: Material. 
        Realizes(M, Periodic(3) âˆ§ Boundary(2))
        âˆ§ Satisfies(M, Hamiltonian)  
        âˆ§ Satisfies(M, Property)
    {
      // Step 1: Choose a suitable bulk crystal structure 
      let a: â„ = 5 * Ã…                 ; Lattice constant (5 Angstroms)
      let Î“: Geometry = FCC(a)         ; Face-centered cubic lattice
      
      // Step 2: Select appropriate atomic orbitals and spin-orbit coupling  
      let (â„“, m, n): (â„¤, â„¤, â„¤) = (1, 1, 0)         ; p-orbitals with m_â„“ = Â±1 
      let Î»: â„ = 0.5 * e * Ã…            ; Spin-orbit coupling strength
      let Ïƒ: TensorProduct(Spin, Orbital) = (Ïƒ_x, Ïƒ_y, Ïƒ_z) âŠ— (Y(1, 1), Y(1, -1))
      
      // Step 3: Construct the bulk tight-binding Hamiltonian  
      let t: â„ = 0.8 * e                ; Hopping amplitude (0.8 eV)
      let m_0: â„ = 1.6 * e              ; Mass term (1.6 eV)
      let â„‹_bulk(k) = (m_0 - t * âˆ‘_<ij> cos(k Â· Î´_ij)) * Ïƒ_z + Î» * (k Ã— Ïƒ) Â· áº‘ 
      
      // Step 4: Verify the nontrivial topology and bulk energy gap
      have m_0 > t > 0 âˆ§ sign(m_0) â‰  sign(m_0 - 3*t)  ; Nontrivial topology
      let Eg_calc = min_{k âˆˆ BZ} |â„‹_bulk(k)|           ; Bulk energy gap      
      assert Eg_calc â‰ˆ Eg                             ; Bulk gap matches target
      
      // Step 5: Construct the boundary Hamiltonian and solve for edge states
      let nÌ‚: Direction = (0, 0, 1)                       ; Surface normal vector
      let â„‹_surf(kâˆ¥) = â„‹_bulk(kâˆ¥, m(kâˆ¥)/v_F * nÌ‚)         ; Surface Hamiltonian  
      let Ïˆ_edge(kâˆ¥): State = Eigenstate(â„‹_surf(kâˆ¥), Î¼)  ; Surface eigenstate
      have âˆ€ kâˆ¥. âŸ¨Ïˆ_edge(kâˆ¥), â„‹_surf(kâˆ¥)(Ïˆ_edge(kâˆ¥))âŸ© â‰ˆ Î¼   ; Surface states at Fermi level
      
      // Step 6: Verify the helical spin texture and quantized surface conductivity
      have SpinTexture(Ïˆ_edge, Î¼) = Helical                  ; Helical spin texture
      let Ïƒ_surf(T): Conductivity = Conductivity(Ïˆ_edge, Î¼, T) 
      have âˆ«(Ïƒ_surf(T), âˆ‚(Î“)) â‰ˆ eÂ²/(2Ï€ * â„)                   ; Quantized conductivity  
      
      // Step 7: Construct the full material with bulk and boundary  
      let M: Material = Atomic(Î“, (â„“, m, n), Î») âˆª Boundary(Î“, Ïˆ_edge)
      
      // Step 8: Verify that the full material realizes the desired properties
      have Realizes(M, Periodic(3) âˆ§ Boundary(2))  ; 3D bulk with 2D boundary 
      have Satisfies(M, â„‹_bulk)                   ; Bulk Hamiltonian
      have Eg(M) > 0                              ; Insulating bulk
      have SpinTexture(âˆ‚(M), Î¼) = Helical         ; Helical surface spin texture
      have âˆ«(Conductivity(âˆ‚(M), Î¼, T), âˆ‚(M)) â‰ˆ eÂ²/(2Ï€ * â„)  ; Quantized surface conductance
      hence proved.
    }
  }
}