CONCEPT QuantumGeometry {
  LANGUAGE {
    type Hilb = FiniteHilbertSpace | SeparableHilbertSpace
    type Obs = BoundedOperator | UnboundedOperator
    type Alg = CAR | CCR | vNAlgebra | CAlgebra
    type Mor = CompletelyPositiveMap | UnitPreservingMap

    notation "A âŠ— B" = TensorProduct(A: Hilb, B: Hilb)
    notation "A âŠ• B" = DirectSum(A: Hilb, B: Hilb)
    notation "A â‰… B" = Isomorphic(A: Hilb, B: Hilb)
    notation "âŸ¨AâŸ©" = AlgebraicSpan(A: Obs)
    notation "Aâ€²" = Commutant(A: Alg)
    notation "A âˆ¨ B" = JoinAlgebra(A: Alg, B: Alg)
    notation "ğ”¼(A)" = ExpectedValue(A: Obs)
    
    notation "Ï† : A â†’ B" = Morphism(Ï†: Mor, A: Alg, B: Alg)
    notation "Ï†*" = Adjoint(Ï†: Mor)
    notation "id[A]" = Identity(A: Hilb)

    axiom TensorFunctor(A, B, C, D: Hilb):  
      (A âŠ— B) â‰… (B âŠ— A),  (A âŠ— (B âŠ— C)) â‰… ((A âŠ— B) âŠ— C),  A âŠ— (B âŠ• C) â‰… (A âŠ— B) âŠ• (A âŠ— C)
    axiom DoubleCommutant(A: Alg): (Aâ€²)â€² = Aâ€³ = A  
    axiom Stinespring(Ï†: Mor, A, B: Alg, K: Hilb):
      Ï† : A â†’ B  â‡’  âˆƒ V : A â†’ B(K).  Ï†(a) = V* a V  
  }

  STRUCTURE {
    [HilbertSpace: 
      {H: InnerProductSpace, complete(H), âŸ¨Ï†, ÏˆâŸ© = âŸ¨Ïˆ, Ï†âŸ©*,  âŸ¨Î±Ï† + Î²Ïˆ, Ï‡âŸ© = Î±âŸ¨Ï†, Ï‡âŸ© + Î²âŸ¨Ïˆ, Ï‡âŸ©}
    ]

    [AlgebraOfObservables(H: Hilb):  
      {A: Subset(Obs(H)), I âˆˆ A,  A, B âˆˆ A â‡’ A + B âˆˆ A,  A âˆˆ A â‡’ A* âˆˆ A}
    ]
    
    GelfandNaimarkTheorem:
      Every C*-algebra is isomorphic to an algebra of bounded operators on some Hilbert space.

    [Functor(F, C, D: Category):
      F: Obj(C) â†’ Obj(D),  F: Mor(C) â†’ Mor(D),  
      F(id[A]) = id[F(A)],  F(g âˆ˜ f) = F(g) âˆ˜ F(f)
    ]
  }

  PROOFS {
    tactic Spectral(A: Obs):
      have A = âˆ« Î» dE(Î»)  ; Spectral theorem
      
    tactic TomitaTakesaki(A: Alg, Î©: Hilb):
      assume (A, Î©) is standard
      let S = J Î”^(1/2) where J is modular conjugation, Î” is modular operator
      have S* a Î© = a* Î© âˆ€ a âˆˆ A  ; Tomita-Takesaki theorem
      hence J A J = Aâ€²  
      
    theorem NoncommutativeStone(A: Alg, H: Hilb, U: Unitary):  
      (A âŠ† B(H)) âˆ§ (U âˆˆ A) âˆ§ (spectrum(U) = S^1) âŠ¢ âˆƒ Ï†: â„ â†’ Aut(A).  Ï†_t(U) = e^(it) U
    {
      assume A âŠ† B(H), U âˆˆ A, spectrum(U) = S^1
      Spectral(U)
      have U = âˆ«_{S^1} Î» dE(Î»)
      define Ï†_t(a) = âˆ«_{S^1} Î»^t dE(Î») a âˆ«_{S^1} Î»^(-t) dE(Î»)  ; Integral form of automorphism
      have Ï†_t(U) = âˆ«_{S^1} Î» Î»^t dE(Î») = e^(it) U
      have t â†¦ Ï†_t is strongly continuous group homomorphism
    }

    theorem Haag(A, B: Alg, H, K: Hilb):  
      (A âŠ† B(H)) âˆ§ (B âŠ† B(K)) âˆ§ (A â‰… B) âŠ¢ âˆƒ U: H â‰… K.  B = U A U*
    {
      assume A âŠ† B(H), B âŠ† B(K), A â‰… B
      let Ï†: A â†’ B witness the isomorphism 

      TomitaTakesaki(A, Î©) for cyclic, separating Î©
      have J_A A J_A = Aâ€² 
      TomitaTakesaki(B, Ï†(Î©))
      have J_B B J_B = Bâ€²
      
      define U a Î© = Ï†(a) Ï†(Î©) âˆ€ a âˆˆ A
      have U A Î© = B Ï†(Î©)  ; By definition
      have U Aâ€² Î© = J_B B J_B Ï†(Î©) = Bâ€² Ï†(Î©)  ; Commutant
      hence U H = K  ; Î©, Ï†(Î©) cyclic
      have U A U* = B  ; By construction
    }
   
    theorem QuantumDeRham(A: Alg, H: Hilb, d: Derivation(A)):
      âˆƒ Î´ âˆˆ Obs(H).  d(a) = Î´ a - a Î´  âˆ€ a âˆˆ A
    {
      assume d: A â†’ A is derivation 
      have d is closable  ; It is a *-derivation
      let K be domain of closure of d
      have K is AF C*-algebra  ; Smooth domain theorem
      let A_n = K âˆ© B(H_n) for expanding H_n â†— H
      
      have d|A_n = ad(Î´_n) for some Î´_n âˆˆ B(H_n)  ; Quantum derivations are inner
      have âˆ¥Î´_n - Î´_{n+1}âˆ¥ â†’ 0  ; Coherence of derivations
      let Î´ = lim Î´_n âˆˆ Obs(H)
      have d(a) = lim ad(Î´_n)(a) = ad(Î´)(a) âˆ€ a âˆˆ â‹ƒ A_n
      
      have â‹ƒ A_n is core for d  ; Closure is AF
      hence d(a) = ad(Î´)(a) âˆ€ a âˆˆ dom(d)  
    }
  }
}